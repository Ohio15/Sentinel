<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Support Portal - Sentinel</title>
  <link rel="stylesheet" href="/portal/styles.css">
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <img id="clientLogo" src="" alt="" style="display: none; object-fit: contain;">
        <svg id="defaultLogo" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
        </svg>
        <span id="portalTitle">Support Portal</span>
      </div>
      <nav class="header-nav" id="headerNav" style="display: none;">
        <button class="nav-btn active" data-page="tickets" onclick="navigateTo('tickets')">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"/>
          </svg>
          My Tickets
        </button>
        <button class="nav-btn" data-page="kb" onclick="navigateTo('kb')">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
          </svg>
          Knowledge Base
        </button>
      </nav>
      <div class="user-info" id="userInfo" style="display: none;">
        <span id="userName"></span>
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode" id="themeToggle">
          <svg id="sunIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
          <svg id="moonIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
        </button>
        <button class="btn btn-secondary btn-sm" onclick="logout()">Sign Out</button>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main">
      <!-- Login Page -->
      <div id="loginPage" class="page">
        <div class="login-container">
          <div class="login-card">
            <h1 id="welcomeTitle">Welcome to Support Portal</h1>
            <p>Sign in with your Microsoft account to submit and track support tickets.</p>
            <div id="errorMessage" class="error-message" style="display: none;"></div>
            <button class="btn btn-primary btn-lg btn-microsoft" onclick="login()">
              <svg width="20" height="20" viewBox="0 0 21 21">
                <rect x="1" y="1" width="9" height="9" fill="#f25022"/>
                <rect x="11" y="1" width="9" height="9" fill="#7fba00"/>
                <rect x="1" y="11" width="9" height="9" fill="#00a4ef"/>
                <rect x="11" y="11" width="9" height="9" fill="#ffb900"/>
              </svg>
              Sign in with Microsoft
            </button>
          </div>
        </div>
      </div>

      <!-- Tickets List Page -->
      <div id="ticketsPage" class="page" style="display: none;">
        <div class="page-header">
          <h1>My Support Tickets</h1>
          <button class="btn btn-primary" onclick="showNewTicketForm()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            New Ticket
          </button>
        </div>

        <!-- Search and Filters -->
        <div class="search-filters">
          <div class="search-box">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input type="text" id="ticketSearch" placeholder="Search tickets..." oninput="handleTicketSearch(event)">
            <button class="search-clear" id="searchClear" onclick="clearTicketSearch()" style="display: none;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <div class="quick-filters">
            <button class="filter-chip active" data-status="all" onclick="setStatusFilter('all')">All</button>
            <button class="filter-chip" data-status="open" onclick="setStatusFilter('open')">Open</button>
            <button class="filter-chip" data-status="in_progress" onclick="setStatusFilter('in_progress')">In Progress</button>
            <button class="filter-chip" data-status="resolved" onclick="setStatusFilter('resolved')">Resolved</button>
            <button class="filter-chip" data-status="closed" onclick="setStatusFilter('closed')">Closed</button>
          </div>
          <button class="btn btn-secondary btn-sm" onclick="toggleAdvancedFilters()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 6h18M7 12h10M10 18h4"/>
            </svg>
            Filters
          </button>
        </div>

        <!-- Advanced Filters -->
        <div class="advanced-filters" id="advancedFilters" style="display: none;">
          <div class="filter-group">
            <label>Priority</label>
            <select id="priorityFilter" onchange="applyFilters()">
              <option value="">All Priorities</option>
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
              <option value="critical">Critical</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Date Range</label>
            <div class="date-range">
              <input type="date" id="dateFrom" onchange="applyFilters()" placeholder="From">
              <span>to</span>
              <input type="date" id="dateTo" onchange="applyFilters()" placeholder="To">
            </div>
          </div>
          <button class="btn btn-secondary btn-sm" onclick="clearFilters()">Clear Filters</button>
        </div>

        <div class="tickets-list" id="ticketsList">
          <div class="loading">Loading tickets...</div>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="ticketsPagination" style="display: none;">
          <button class="btn btn-secondary btn-sm" id="prevPageBtn" onclick="goToPage(currentPage - 1)" disabled>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            Previous
          </button>
          <span class="page-info" id="pageInfo">Page 1 of 1</span>
          <button class="btn btn-secondary btn-sm" id="nextPageBtn" onclick="goToPage(currentPage + 1)" disabled>
            Next
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </div>
      </div>

      <!-- New Ticket Page -->
      <div id="newTicketPage" class="page" style="display: none;">
        <div class="page-header">
          <button class="btn btn-secondary" onclick="showTicketsList()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            Back
          </button>
          <h1>Submit New Ticket</h1>
        </div>

        <!-- Suggested Articles -->
        <div class="suggested-articles" id="suggestedArticles" style="display: none;">
          <div class="suggested-articles-header">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            <span>These articles might help</span>
            <button class="close-btn" onclick="hideSuggestedArticles()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <div class="suggested-articles-list" id="suggestedArticlesList"></div>
        </div>

        <form class="ticket-form" id="newTicketForm" onsubmit="submitTicket(event)">
          <div class="form-group">
            <label for="submittedBy">Submitted By</label>
            <input type="text" id="submittedBy" name="submittedBy" readonly class="readonly-field">
          </div>
          <div class="form-group">
            <label for="subject">Subject *</label>
            <input type="text" id="subject" name="subject" required placeholder="Brief description of the issue" oninput="handleSubjectInput(event)">
          </div>
          <div class="form-group">
            <label for="deviceName">Device/Computer Name</label>
            <input type="text" id="deviceName" name="deviceName" placeholder="Name of the affected computer (optional)">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="priority">Priority</label>
              <select id="priority" name="priority">
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="high">High</option>
                <option value="critical">Critical</option>
              </select>
            </div>
            <div class="form-group">
              <label for="type">Type</label>
              <select id="type" name="type">
                <option value="incident" selected>Incident</option>
                <option value="request">Service Request</option>
                <option value="question">Question</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="description">Description *</label>
            <textarea id="description" name="description" rows="6" required placeholder="Please provide as much detail as possible about your issue..."></textarea>
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="showTicketsList()">Cancel</button>
            <button type="submit" class="btn btn-primary" id="submitBtn">Submit Ticket</button>
          </div>
        </form>
      </div>

      <!-- Ticket Detail Page -->
      <div id="ticketDetailPage" class="page" style="display: none;">
        <div class="page-header">
          <button class="btn btn-secondary" onclick="showTicketsList()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            Back
          </button>
          <h1 id="ticketDetailTitle">Ticket Details</h1>
        </div>
        <div class="ticket-detail" id="ticketDetail">
          <div class="loading">Loading ticket...</div>
        </div>
      </div>

      <!-- Knowledge Base Page -->
      <div id="kbPage" class="page" style="display: none;">
        <div class="kb-layout">
          <!-- KB Sidebar -->
          <aside class="kb-sidebar">
            <div class="kb-search">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
              <input type="text" id="kbSearch" placeholder="Search articles..." oninput="handleKBSearch(event)">
            </div>
            <nav class="kb-categories" id="kbCategories">
              <div class="loading">Loading...</div>
            </nav>
          </aside>

          <!-- KB Content -->
          <div class="kb-content">
            <div class="kb-header">
              <h1 id="kbTitle">Knowledge Base</h1>
              <p id="kbSubtitle">Find answers to common questions</p>
            </div>

            <!-- Featured Articles -->
            <section class="kb-featured" id="kbFeatured" style="display: none;">
              <h2>Featured Articles</h2>
              <div class="kb-featured-grid" id="kbFeaturedGrid"></div>
            </section>

            <!-- Articles List -->
            <section class="kb-articles" id="kbArticles">
              <div class="loading">Loading articles...</div>
            </section>

            <!-- Search Results -->
            <section class="kb-search-results" id="kbSearchResults" style="display: none;">
              <h2>Search Results</h2>
              <div class="kb-articles-list" id="kbSearchResultsList"></div>
            </section>
          </div>
        </div>
      </div>

      <!-- KB Article Detail Page -->
      <div id="kbArticlePage" class="page" style="display: none;">
        <div class="page-header">
          <button class="btn btn-secondary" onclick="showKBPage()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            Back to Knowledge Base
          </button>
        </div>
        <article class="kb-article-detail" id="kbArticleDetail">
          <div class="loading">Loading article...</div>
        </article>

        <!-- Article Feedback -->
        <div class="article-feedback" id="articleFeedback" style="display: none;">
          <p>Was this article helpful?</p>
          <div class="feedback-buttons">
            <button class="btn btn-secondary feedback-btn" onclick="submitKBFeedback(true)">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
              </svg>
              Yes, helpful
            </button>
            <button class="btn btn-secondary feedback-btn" onclick="submitKBFeedback(false)">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path>
              </svg>
              No, not helpful
            </button>
          </div>
          <div class="feedback-thanks" id="feedbackThanks" style="display: none;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            <span>Thank you for your feedback!</span>
          </div>
        </div>

        <!-- Related Articles -->
        <div class="related-articles" id="relatedArticles" style="display: none;">
          <h3>Related Articles</h3>
          <div class="related-articles-list" id="relatedArticlesList"></div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <p>Powered by Sentinel RMM</p>
    </footer>
  </div>

  <script src="/portal/app.js"></script>
</body>
</html>
