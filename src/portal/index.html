<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Support Portal - Sentinel</title>
  <link rel="stylesheet" href="/portal/styles.css">
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <img id="clientLogo" src="" alt="" style="display: none; width: 32px; height: 32px; object-fit: contain;">
        <svg id="defaultLogo" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
        </svg>
        <span id="portalTitle">Support Portal</span>
      </div>
      <div class="user-info" id="userInfo" style="display: none;">
        <span id="userName"></span>
        <button class="btn btn-secondary btn-sm" onclick="logout()">Sign Out</button>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main">
      <!-- Login Page -->
      <div id="loginPage" class="page">
        <div class="login-container">
          <div class="login-card">
            <h1 id="welcomeTitle">Welcome to Support Portal</h1>
            <p>Sign in with your Microsoft account to submit and track support tickets.</p>
            <div id="errorMessage" class="error-message" style="display: none;"></div>
            <button class="btn btn-primary btn-lg btn-microsoft" onclick="login()">
              <svg width="20" height="20" viewBox="0 0 21 21">
                <rect x="1" y="1" width="9" height="9" fill="#f25022"/>
                <rect x="11" y="1" width="9" height="9" fill="#7fba00"/>
                <rect x="1" y="11" width="9" height="9" fill="#00a4ef"/>
                <rect x="11" y="11" width="9" height="9" fill="#ffb900"/>
              </svg>
              Sign in with Microsoft
            </button>
          </div>
        </div>
      </div>

      <!-- Tickets List Page -->
      <div id="ticketsPage" class="page" style="display: none;">
        <div class="page-header">
          <h1>My Support Tickets</h1>
          <button class="btn btn-primary" onclick="showNewTicketForm()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            New Ticket
          </button>
        </div>
        <div class="tickets-list" id="ticketsList">
          <div class="loading">Loading tickets...</div>
        </div>
      </div>

      <!-- New Ticket Page -->
      <div id="newTicketPage" class="page" style="display: none;">
        <div class="page-header">
          <button class="btn btn-secondary" onclick="showTicketsList()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            Back
          </button>
          <h1>Submit New Ticket</h1>
        </div>
        <form class="ticket-form" id="newTicketForm" onsubmit="submitTicket(event)">
          <div class="form-group">
            <label for="submittedBy">Submitted By</label>
            <input type="text" id="submittedBy" name="submittedBy" readonly class="readonly-field">
          </div>
          <div class="form-group">
            <label for="subject">Subject *</label>
            <input type="text" id="subject" name="subject" required placeholder="Brief description of the issue">
          </div>
          <div class="form-group">
            <label for="deviceName">Device/Computer Name</label>
            <input type="text" id="deviceName" name="deviceName" placeholder="Name of the affected computer (optional)">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="priority">Priority</label>
              <select id="priority" name="priority">
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="high">High</option>
                <option value="critical">Critical</option>
              </select>
            </div>
            <div class="form-group">
              <label for="type">Type</label>
              <select id="type" name="type">
                <option value="incident" selected>Incident</option>
                <option value="request">Service Request</option>
                <option value="question">Question</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="description">Description *</label>
            <textarea id="description" name="description" rows="6" required placeholder="Please provide as much detail as possible about your issue..."></textarea>
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="showTicketsList()">Cancel</button>
            <button type="submit" class="btn btn-primary" id="submitBtn">Submit Ticket</button>
          </div>
        </form>
      </div>

      <!-- Ticket Detail Page -->
      <div id="ticketDetailPage" class="page" style="display: none;">
        <div class="page-header">
          <button class="btn btn-secondary" onclick="showTicketsList()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            Back
          </button>
          <h1 id="ticketDetailTitle">Ticket Details</h1>
        </div>
        <div class="ticket-detail" id="ticketDetail">
          <div class="loading">Loading ticket...</div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <p>Powered by Sentinel RMM</p>
    </footer>
  </div>

  <script src="/portal/app.js"></script>
</body>
</html>
